<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 5.2, http://www.gnu.org/software/texinfo/ -->
<head>
<title>ECB - the Emacs Code Browser: Checking the state</title>

<meta name="description" content="ECB - the Emacs Code Browser: Checking the state">
<meta name="keywords" content="ECB - the Emacs Code Browser: Checking the state">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="ecb.html#Top" rel="start" title="Top">
<link href="Command-Index.html#Command-Index" rel="index" title="Command Index">
<link href="Concept-Index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Version_002dcontrol-support.html#Version_002dcontrol-support" rel="up" title="Version-control support">
<link href="Remote-repositories.html#Remote-repositories" rel="next" title="Remote repositories">
<link href="Identifying-backends.html#Identifying-backends" rel="prev" title="Identifying backends">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.indentedblock {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smallindentedblock {margin-left: 3.2em; font-size: smaller}
div.smalllisp {margin-left: 3.2em}
kbd {font-style:oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nocodebreak {white-space:nowrap}
span.nolinebreak {white-space:nowrap}
span.roman {font-family:serif; font-weight:normal}
span.sansserif {font-family:sans-serif; font-weight:normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">
<a name="Checking-the-state"></a>
<div class="header">
<p>
Next: <a href="Remote-repositories.html#Remote-repositories" accesskey="n" rel="next">Remote repositories</a>, Previous: <a href="Identifying-backends.html#Identifying-backends" accesskey="p" rel="prev">Identifying backends</a>, Up: <a href="Version_002dcontrol-support.html#Version_002dcontrol-support" accesskey="u" rel="up">Version-control support</a> &nbsp; [<a href="Concept-Index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Command-Index.html#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="How-ECB-checks-the-VC_002dstate-of-a-file"></a>
<h4 class="subsection">10.8.2 How ECB checks the VC-state of a file</h4>

<p>After ECB has identified the VC-backend of a directory it will display
the VC-state (e.g. up-to-date, edited, needs-mergs etc...) with a
suitable image-icon in the tree-windows of the ECB-file-browser. To
get this state for a certain file ECB uses that check-state-function
stored in the cache for the directory of that file (see <a href="Identifying-backends.html#Identifying-backends">Identifying backends</a>).
</p>
<p>You can add any arbitrary functions as check-state-function to
<code>ecb-vc-supported-backends</code> as long as they get one
filename-argument and return a state-symbol (e.g. <code>up-to-date</code>.
ECB can understand a certain set of state-values which are then
mapped to suitable image-icons which will in turn be displayed in
front of the filename in the file-browser. Because the values a
check-state-function return can differ from that state-values ECB
understands, ECB offers an option to define a appropriate
state-mapping. The name of this option is <code>ecb-vc-state-mapping</code>.
See the documentation of this option to get a list of all state-value
ECB understands.
</p>
<p>Per default ECB uses the function <code>vc-state</code> of the
VC-package<a name="DOCF38" href="#FOOT38"><sup>38</sup></a> to check the state for the
backends CVS, RCS, SCCS, Subversion, Git and Monotone. So the default-value of
<code>ecb-vc-state-mapping</code> contains a mapping between these values
<code>ecb-vc-state</code> can return and that state-values ECB understands.
</p>
<p>If ECB should support other VC-backends than CVS, RCS, SCCS, Monotone, Git and
Subversion (e.g. Clearcase) you should add that new backend to the VC-package
(see the initial comments of vc.el how to do this) then ECB will automatically
support that new backend. Alternatively it may be sufficient if you write your
own check-state-function for this backend and add the needed mapping to
<code>ecb-vc-state-mapping</code> if necessary.
</p>
<a name="Getting-heuristic-state_002dvalues-or-real-ones-for-a-backend"></a>
<h4 class="subsubsection">10.8.2.1 Getting heuristic state-values or real ones for a backend</h4>

<p>The interface of Emacs&rsquo; VC-package offers two different ways to
get the VC-state of a file:
</p>
<ul>
<li> The real, fresh and expensive approach

<p>VC has a function <code>vc-recompute-state</code> which always performs a real
backend command (e.g. &ldquo;cvs status&rdquo; for CVS) to get a fresh and real state
for a file. As you can imagine this operation can be very expensive and long
lasting depending on the location of the repository. But for CVS the
CVS-backend of VC offers with the option <code>vc-cvs-stay-local</code> a way to
tell Emacs to stay local even for the sake of getting a real
state<a name="DOCF39" href="#FOOT39"><sup>39</sup></a>.
</p>
<p>ECB offers <code>ecb-vc-recompute-state</code> for this approach which is an alias
for <code>vc-recompute-state</code>.
</p>
</li><li> The heuristic approach:

<p>The function <code>vc-state</code> always returns a &ldquo;heuristic&rdquo; state
which should be used when a fresh and real state is not necessary.
With <code>vc-state</code> the option <code>vc-cvs-stay-local</code> will never
take effect.
</p>
<p>ECB offers <code>ecb-vc-state</code> for this approach - see below for the
difference between <code>vc-state</code> and <code>ecb-vc-state</code>.
</p></li></ul>

<p>Example CVS:
</p>
<p>VC/CVS actually does it this way (regardless if ECB is active or
not): When you visit a file, it always uses just the heuristic to get the
state (comparing file times), regardless of the setting of
<code>vc-cvs-stay-local</code>. This is because the &quot;fresh-but-slow&quot; state is
determined by calling &quot;cvs status&quot; on the file, and this was deemed
unacceptably slow if done at visiting time under any conditions.
</p>
<p>The state is updated by calling <code>vc-recompute-state</code> prior to
<code>vc-next-action</code> (C-x v v) which either checks a file in or out.
IF <code>vc-cvs-stay-local</code> is nil, then this does in fact call &quot;cvs
status&quot; to get the &quot;fresh-but-slow-state&quot;, but if
<code>vc-cvs-stay-local</code> is t, then it just compares the file times
again.
</p>
<p>But under certain conditions (e.g. if called for files not already
visited or for files their VC-state has been changed from outside
Emacs, e.g. by checking in the file via command line) <code>vc-state</code>
does not compute a new heuristic state but returns a cached one
(cached by the VC-package itself not by ECB) which does not reflect
the current VC-state. Example: if you have edited a file within Emacs
and then checked in from outside Emacs <code>vc-state</code> returns a wrong
state until you call <code>revert-buffer</code> for this file. Therefore ECB
offers the check-state-function <code>ecb-vc-state</code> which does the
same as <code>vc-state</code> but it clears the internal caches of the
VC-package for that file before calling <code>vc-state</code>.
</p>
<p>The bottom line for you is this: If you use <code>ecb-vc-state</code> in
<code>ecb-vc-supported-backends</code> to get the version control state, then you
get the same policy that VC uses and you get always a &ldquo;correct&rdquo; heuristic
state (as correct as possible a heuristic state can be). There should no harm
if you use <code>ecb-vc-recompute-state</code> (which is an alias for
<code>vc-recompute-state</code>) as a replacement function if you want to get fresh
and real state-values, but then (a) you must make sure to set
<code>vc-cvs-stay-local</code> to nil, and (b) fetching the state over the network
under all conditions was deemed unacceptably slow in VC.
</p>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h3><a name="FOOT38" href="#DOCF38">(38)</a></h3>
<p>The VC-package of Emacs offers a standardised and uniform
interface for several backends; per default CVS, RCS, SCCS, Subversion, Git
and Monotone are supported by the VC-package.</p>
<h3><a name="FOOT39" href="#DOCF39">(39)</a></h3>
<p>For other backends you have to check the VC-manual if there is
equivalent option</p>
</div>
<hr>
<div class="header">
<p>
Next: <a href="Remote-repositories.html#Remote-repositories" accesskey="n" rel="next">Remote repositories</a>, Previous: <a href="Identifying-backends.html#Identifying-backends" accesskey="p" rel="prev">Identifying backends</a>, Up: <a href="Version_002dcontrol-support.html#Version_002dcontrol-support" accesskey="u" rel="up">Version-control support</a> &nbsp; [<a href="Concept-Index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Command-Index.html#Command-Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
